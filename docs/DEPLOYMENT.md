# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡

1. [æœ€æ–°ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †](#æœ€æ–°ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †)
2. [ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰é›†](#ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰é›†)
3. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
4. [ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †](#ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †)

---

## æœ€æ–°ç‰ˆãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. ã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶š

```bash
ssh root@x85-131-247-170
```

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```bash
cd ~/yaku_navi
```

### 3. æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

```bash
git pull origin main
```

### 4. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ›´æ–°

```bash
cd backend
npm install
npm run build
cd ..
```

### 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ›´æ–°

```bash
cd frontend
npm install
npm run build
cd ..
```

### 6. PM2ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å†èµ·å‹•
pm2 restart yaku-navi-backend

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å†èµ·å‹•
pm2 restart yaku-navi-frontend

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 status
```

### 7. ãƒ­ã‚°ç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°
pm2 logs yaku-navi-backend --lines 50

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°
pm2 logs yaku-navi-frontend --lines 50
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰é›†

### ä¸€æ‹¬å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆç”¨ï¼‰

```bash
cd ~/yaku_navi && \
cd backend && npm install && npm run build && cd .. && \
cd frontend && npm install && npm run build && cd .. && \
pm2 restart all && \
pm2 logs --lines 50
```

### PM2ã‚³ãƒãƒ³ãƒ‰

```bash
# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•
pm2 restart all

# å€‹åˆ¥ã«å†èµ·å‹•
pm2 restart yaku-navi-backend
pm2 restart yaku-navi-frontend

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 status

# ãƒ­ã‚°ç¢ºèª
pm2 logs --lines 50
pm2 logs --err --lines 100
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: `npm install`ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

```bash
# node_modulesã‚’å‰Šé™¤ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
```

### å•é¡Œ2: `npm run build`ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

```bash
# .nextãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¦å†ãƒ“ãƒ«ãƒ‰
rm -rf .next
npm run build
```

### å•é¡Œ3: PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ

```bash
# PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’ç¢ºèª
pm2 list

# ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ã«èµ·å‹•
cd ~/yaku_navi/backend
pm2 start npm --name "yaku-navi-backend" -- start
cd ../frontend
pm2 start npm --name "yaku-navi-frontend" -- start
pm2 save
```

### å•é¡Œ4: ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆ

```bash
# ãƒãƒ¼ãƒˆ5001ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ã‚’ç¢ºèª
lsof -i :5001

# ãƒãƒ¼ãƒˆ3000ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã‚’ç¢ºèª
lsof -i :3000

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
kill -9 <PID>
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç¢ºèª

```bash
curl http://localhost:5001/health
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
- `https://yaku-navi.com`
- `https://yaku-navi.com/pharmacy/dashboard`
- `https://yaku-navi.com/pharmacist/dashboard`

### 3. æ©Ÿèƒ½ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æ¡ç”¨æ¸ˆã¿è–¬å‰¤å¸«ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”»é¢ã§åŒ¿ååŒ–ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹
- [ ] æ”¯æ‰•ã„å ±å‘Šå¾Œã«è‡ªå‹•é·ç§»ã™ã‚‹
- [ ] è–¬å‰¤å¸«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã« `/pharmacist/login` ã«é·ç§»ã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

---

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

```bash
cd ~/yaku_navi
git log --oneline -10  # ä»¥å‰ã®ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèª
git checkout <previous-commit-hash>
cd backend && npm run build
cd ../frontend && npm run build
pm2 restart yaku-navi-backend
pm2 restart yaku-navi-frontend
```

---

## ğŸ“ æ³¨æ„äº‹é …

- ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨
- æœ¬ç•ªç’°å¢ƒã§ã¯ `NODE_ENV=production` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env`ï¼‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ“ãƒ«ãƒ‰æ™‚é–“: `npm run build` ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ãƒ“ãƒ«ãƒ‰ä¸­ã¯ãƒ¡ãƒ¢ãƒªã‚’å¤šãä½¿ç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ : PM2ã®å†èµ·å‹•ä¸­ã¯ä¸€æ™‚çš„ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨ã§ããªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™

---

**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ28æ—¥

