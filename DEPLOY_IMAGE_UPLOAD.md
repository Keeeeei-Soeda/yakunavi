# ğŸ“¸ ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½æ‹¡å¼µã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

## ãƒ‡ãƒ—ãƒ­ã‚¤å†…å®¹

- HEIC/HEIF/WebPå½¢å¼ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®HEIC/HEIFâ†’JPEGè‡ªå‹•å¤‰æ›æ©Ÿèƒ½
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ã‚’5MBâ†’10MBã«å¤‰æ›´
- ç®¡ç†è€…å´ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½æ‹¡å¼µï¼ˆPDF/ç”»åƒè¡¨ç¤ºå¯¾å¿œï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠUIæ‹¡å¼µ

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### æ–°è¦ä¾å­˜é–¢ä¿‚ã®è¿½åŠ 
- **sharp** ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼ˆç”»åƒå¤‰æ›ç”¨ï¼‰
- ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ `npm install` ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### å¿…è¦ãªã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- Node.js 20ä»¥ä¸Š
- sharpãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™

## ã‚µãƒ¼ãƒãƒ¼å´ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. ã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶š

```bash
ssh root@x85-131-247-170
```

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```bash
cd ~/yaku_navi
```

### 3. æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

```bash
git pull origin main
```

### 4. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ›´æ–°

```bash
cd backend
npm install  # sharpãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm run build
cd ..
```

**æ³¨æ„**: `npm install` ã§ sharp ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ãŸã‚ã€æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ›´æ–°

```bash
cd frontend
npm install
npm run build
cd ..
```

### 6. PM2ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å†èµ·å‹•
pm2 restart yaku-navi-backend

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å†èµ·å‹•
pm2 restart yaku-navi-frontend

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 status
```

### 7. ãƒ­ã‚°ç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ï¼ˆã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèªï¼‰
pm2 logs yaku-navi-backend --lines 50

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°
pm2 logs yaku-navi-frontend --lines 50
```

## ä¸€æ‹¬å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆç”¨ï¼‰

```bash
cd ~/yaku_navi && \
git pull origin main && \
cd backend && npm install && npm run build && cd .. && \
cd frontend && npm install && npm run build && cd .. && \
pm2 restart yaku-navi-backend && pm2 restart yaku-navi-frontend && \
pm2 status && \
pm2 logs --lines 50
```

## ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèªäº‹é …

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:5001/health
```

### 2. æ©Ÿèƒ½ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] è–¬å‰¤å¸«å´ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå‹•ä½œã™ã‚‹
- [ ] PDFã€JPEGã€PNGã€HEICã€HEIFã€WebPå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹
- [ ] HEIC/HEIFå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«JPEGã«å¤‰æ›ã•ã‚Œã‚‹
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º10MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹
- [ ] ç®¡ç†è€…å´ã®è¨¼æ˜æ›¸ç¢ºèªç”»é¢ã§PDFã¨ç”»åƒãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒé©åˆ‡ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã•ã‚Œã‚‹

### 3. ã‚¨ãƒ©ãƒ¼ç¢ºèª

ã‚‚ã—ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
pm2 logs yaku-navi-backend --err --lines 100

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
pm2 logs yaku-navi-frontend --err --lines 100
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: sharpãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

```bash
# node_modulesã‚’å‰Šé™¤ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd ~/yaku_navi/backend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### å•é¡Œ2: ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

sharpã®ãƒ“ãƒ«ãƒ‰ã«ã¯ãƒ¡ãƒ¢ãƒªãŒå¿…è¦ã§ã™ã€‚ãƒ¡ãƒ¢ãƒªãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆï¼š

```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç¢ºèª
free -h

# å¿…è¦ã«å¿œã˜ã¦ã‚¹ãƒ¯ãƒƒãƒ—ã‚’å¢—ã‚„ã™ã‹ã€ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
```

### å•é¡Œ3: ç”»åƒå¤‰æ›ãŒå‹•ä½œã—ãªã„

```bash
# sharpãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
cd ~/yaku_navi/backend
node -e "console.log(require('sharp'))"
```

### å•é¡Œ4: PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
# PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’ç¢ºèª
pm2 list

# ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ã«èµ·å‹•
cd ~/yaku_navi/backend
pm2 start npm --name "yaku-navi-backend" -- start
cd ../frontend
pm2 start npm --name "yaku-navi-frontend" -- start
pm2 save
```

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼š

```bash
cd ~/yaku_navi
git log --oneline -10  # ä»¥å‰ã®ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèª
git checkout <previous-commit-hash>
cd backend && npm install && npm run build
cd ../frontend && npm install && npm run build
pm2 restart yaku-navi-backend
pm2 restart yaku-navi-frontend
```

## ğŸ“ å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- `backend/src/controllers/pharmacist-profile.controller.ts` - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†æ‹¡å¼µ
- `backend/src/utils/image-converter.ts` - ç”»åƒå¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæ–°è¦ï¼‰
- `backend/src/controllers/admin.controller.ts` - Content-Typeåˆ¤å®šæ‹¡å¼µ
- `backend/package.json` - sharpãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¿½åŠ 

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- `frontend/app/pharmacist/profile/page.tsx` - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠUIæ‹¡å¼µ
- `frontend/app/admin/certificates/page.tsx` - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½æ‹¡å¼µ

## âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ç¢ºèª

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæ­£å¸¸ã«å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§è–¬å‰¤å¸«å´ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
2. è³‡æ ¼è¨¼æ˜æ›¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
3. å„ç¨®ç”»åƒå½¢å¼ï¼ˆç‰¹ã«HEIC/HEIFï¼‰ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è©¦è¡Œ
4. ç®¡ç†è€…å´ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

