# ğŸ”§ PM2ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

## å•é¡Œ: `Process or Namespace backend not found`

PM2ã®ãƒ—ãƒ­ã‚»ã‚¹åãŒ`backend`ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ“‹ è§£æ±ºæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’ç¢ºèª

```bash
pm2 list
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ç¾åœ¨å®Ÿè¡Œä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹åã‚’ç¢ºèªã§ãã¾ã™ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ—ãƒ­ã‚»ã‚¹åã«å¿œã˜ãŸå†èµ·å‹•

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ—ãƒ­ã‚»ã‚¹åãŒ`yaku-navi-backend`ã®å ´åˆ

```bash
pm2 restart yaku-navi-backend
pm2 logs yaku-navi-backend --lines 50
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ—ãƒ­ã‚»ã‚¹åãŒ`backend`ã®å ´åˆ

```bash
pm2 restart backend
pm2 logs backend --lines 50
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ—ãƒ­ã‚»ã‚¹åãŒ`all`ã®å ´åˆï¼ˆã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•ï¼‰

```bash
pm2 restart all
pm2 logs --lines 50
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³4: ãƒ—ãƒ­ã‚»ã‚¹IDã§å†èµ·å‹•

```bash
# ãƒ—ãƒ­ã‚»ã‚¹IDã‚’ç¢ºèª
pm2 list

# ãƒ—ãƒ­ã‚»ã‚¹IDã§å†èµ·å‹•ï¼ˆä¾‹: IDãŒ0ã®å ´åˆï¼‰
pm2 restart 0
pm2 logs 0 --lines 50
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å¯¾å‡¦

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: æ–°è¦ã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•

```bash
cd ~/yaku_navi/backend

# TypeScriptã‚’ãƒ“ãƒ«ãƒ‰
npm run build

# PM2ã§èµ·å‹•
pm2 start dist/index.js --name "backend" --update-env
# ã¾ãŸã¯
pm2 start npm --name "backend" -- start --update-env
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: æ—¢å­˜ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªã—ã¦å†èµ·å‹•

```bash
# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
pm2 list

# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•
pm2 restart all --update-env

# ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs --lines 50
```

---

## ğŸ” ç’°å¢ƒå¤‰æ•°ã®æ›´æ–°

PM2ã§ç’°å¢ƒå¤‰æ•°ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€`--update-env`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```bash
pm2 restart all --update-env
```

ã¾ãŸã¯ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸå¾Œï¼š

```bash
pm2 restart all --update-env
pm2 save
```

---

## ğŸ“ ã‚ˆãã‚ã‚‹PM2ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’è¡¨ç¤º
pm2 list

# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•
pm2 restart all

# ç’°å¢ƒå¤‰æ•°ã‚’æ›´æ–°ã—ã¦å†èµ·å‹•
pm2 restart all --update-env

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
pm2 stop all

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰Šé™¤
pm2 delete all

# ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs

# ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs backend --lines 50

# ãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª
pm2 status

# ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±ã‚’ä¿å­˜
pm2 save
```

---

## ğŸš€ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®èµ·å‹•æ–¹æ³•

### æ–¹æ³•1: ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èµ·å‹•

```bash
cd ~/yaku_navi/backend

# ãƒ“ãƒ«ãƒ‰
npm run build

# PM2ã§èµ·å‹•
pm2 start dist/index.js --name "backend" --update-env
pm2 save
```

### æ–¹æ³•2: npmã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰èµ·å‹•

```bash
cd ~/yaku_navi/backend

# PM2ã§èµ·å‹•
pm2 start npm --name "backend" -- start --update-env
pm2 save
```

---

## âœ… ç¢ºèªæ‰‹é †

```bash
# 1. PM2ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’ç¢ºèª
pm2 list

# 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
# ãƒ—ãƒ­ã‚»ã‚¹åãŒè¡¨ç¤ºã•ã‚Œã€statusãŒ"online"ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

# 3. ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs backend --lines 50
# ã¾ãŸã¯
pm2 logs --lines 50

# 4. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs --err --lines 50

# 5. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:5001/health
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ãƒ—ãƒ­ã‚»ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
pm2 list

# ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ã«èµ·å‹•
cd ~/yaku_navi/backend
npm run build
pm2 start dist/index.js --name "backend" --update-env
```

### å•é¡Œ2: ç’°å¢ƒå¤‰æ•°ãŒæ›´æ–°ã•ã‚Œãªã„

```bash
# --update-envãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨
pm2 restart all --update-env

# ã¾ãŸã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰Šé™¤ã—ã¦å†èµ·å‹•
pm2 delete all
cd ~/yaku_navi/backend
npm run build
pm2 start dist/index.js --name "backend" --update-env
pm2 save
```

### å•é¡Œ3: ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# ãƒãƒ¼ãƒˆ5001ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :5001

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
pm2 stop all
# ã¾ãŸã¯
kill -9 <PID>
```

---

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `pm2 list`ã§ãƒ—ãƒ­ã‚»ã‚¹åã‚’ç¢ºèª
- [ ] æ­£ã—ã„ãƒ—ãƒ­ã‚»ã‚¹åã§å†èµ·å‹•
- [ ] `--update-env`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨
- [ ] ãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§å‹•ä½œç¢ºèª

