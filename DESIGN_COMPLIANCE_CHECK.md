# 設計書との整合性チェック結果

## チェック実施日: 2026年1月27日

---

## 🔴 重大な問題（即座に修正が必要）

### 1. バックエンドサーバー起動不可
**問題:** `backend/src/index.ts` が空ファイル
**影響:** バックエンドサーバーが起動できない
**優先度:** 🔴 最優先
**設計書:** 全機能に影響

---

## 🟡 薬局側の不足機能

### 2. 薬局側：正式オファー送信UI（メッセージ画面から）
**設計書:** `pharmacy_system_design.md` 6.3 正式オファー送信
**現状:** 
- メッセージ画面に正式オファー送信ボタンがない
- 初回出勤日選択後、正式オファーを送信するUIがない
**必要な実装:**
- メッセージ画面に「正式オファーを送信」ボタン
- 正式オファー送信確認ダイアログ（契約内容、手数料、重要事項の表示）
- 同意チェックボックス
- 送信処理

**user_journey_scenarios.md との整合性:**
- Day 7: 薬局が正式オファーを送信するシーンが実装されていない

### 3. 薬局側：応募者詳細ページ（プロフィール閲覧）
**設計書:** `pharmacy_system_design.md` 5.2 応募者詳細（プロフィール閲覧）
**現状:**
- `/pharmacy/applications/[id]` ページが存在しない
- 応募一覧から詳細ページへの遷移がない
- プロフィール情報の詳細表示がない
**必要な実装:**
- 応募者詳細ページ（`/pharmacy/applications/[id]`）
- 手数料支払い前の表示情報（年齢、出身大学、経歴、スキルなど）
- 個人情報非表示の注記
- 「オファーを送る」「辞退する」ボタン

**user_journey_scenarios.md との整合性:**
- Day 6: 応募者詳細を確認するシーンが実装されていない

### 4. 薬局側：メッセージ画面の契約条件確認表示
**設計書:** `pharmacy_system_design.md` 6.2.2 条件確認表示（自動表示）
**現状:**
- メッセージ画面に契約条件の常時表示がない
**必要な実装:**
- メッセージエリアに契約条件を常時表示
- 勤務日数、報酬総額、勤務時間の表示
- 「この内容で問題なければ、正式オファーをお送りください」の案内

---

## 🟡 薬剤師側の不足機能

### 5. 薬剤師側：求人詳細ページ
**設計書:** `pharmacist_system_design.md` 4.1 求人詳細
**現状:**
- `/pharmacist/jobs/[id]` ページが存在しない
- 求人一覧から直接応募する形になっている
**必要な実装:**
- 求人詳細ページ（`/pharmacist/jobs/[id]`）
- 基本情報、報酬・勤務条件、求人詳細、応募条件、薬局情報の表示
- 「応募する」ボタン

**user_journey_scenarios.md との整合性:**
- Day 6: 求人詳細を確認してから応募するシーンが実装されていない

### 6. 薬剤師側：応募確認画面（必須情報入力）
**設計書:** `pharmacist_system_design.md` 4.2.1 応募確認画面
**現状:**
- 求人一覧から直接応募する形で、必須情報入力画面がない
**必要な実装:**
- 応募確認画面（モーダルまたは別ページ）
- 最寄駅の入力（必須）
- 勤務経験のある業態の選択（最低1つ必須）
- 簡単な自己紹介（任意・推奨）
- 注意事項の表示
- 資格証明書未確認の場合の警告とプロフィールページへのリンク

**user_journey_scenarios.md との整合性:**
- Day 6: 応募時に必須情報を入力するシーンが実装されていない

### 7. 薬剤師側：勤務中の薬局（契約管理）ページ
**設計書:** `pharmacist_system_design.md` 6. 勤務中の薬局（契約管理）
**現状:**
- `/pharmacist/contracts` または `/pharmacist/applications` に契約管理機能がない
- 契約詳細ページがない
**必要な実装:**
- 契約一覧ページ（`/pharmacist/contracts` または `/pharmacist/applications` に追加）
- 契約詳細ページ（`/pharmacist/contracts/[id]`）
- ステータス別の表示（手数料支払い待ち、契約成立）
- 薬局の連絡先開示表示（手数料支払い後）
- 労働条件通知書・契約書のダウンロード
- 「勤務中の薬局を見る」リンクの遷移先

**user_journey_scenarios.md との整合性:**
- Day 19: 契約詳細を確認するシーンが実装されていない
- Day 19: 薬局の連絡先を確認するシーンが実装されていない

---

## 🟡 共通の不足機能

### 8. 通知機能
**設計書:** 
- `pharmacist_system_design.md` 7. 通知機能
- `pharmacy_system_design.md` 11. 通知機能
**現状:**
- 通知機能が実装されていない
- 通知一覧ページがない
- 通知設定ページがない
**必要な実装:**
- 通知モデル（データベース）
- 通知API（作成、取得、既読処理）
- 通知一覧ページ
- 通知設定ページ
- メール通知機能（バックエンド）

**user_journey_scenarios.md との整合性:**
- 全シーン: メール通知・システム通知が実装されていない

### 9. 資格証明書の確認機能（管理者側）
**設計書:** `user_journey_scenarios.md` 3. 管理者側の使用イメージ
**現状:**
- 管理者側の証明書確認UIが実装されていない
**必要な実装:**
- 管理者側の証明書確認ページ
- PDF表示機能
- 承認/差し戻し機能
- 差し戻し理由の入力

**user_journey_scenarios.md との整合性:**
- Day 2: 管理者が証明書を確認するシーンが実装されていない

### 10. 支払い確認機能（管理者側）
**設計書:** `user_journey_scenarios.md` 3. 管理者側の使用イメージ
**現状:**
- 管理者側の支払い確認UIが実装されていない
**必要な実装:**
- 管理者側の支払い確認ページ
- 支払い報告の一覧表示
- 入金確認処理
- 確認後の契約ステータス更新と個人情報開示

**user_journey_scenarios.md との整合性:**
- Day 19: 管理者が支払いを確認するシーンが実装されていない

---

## 🟢 実装済みだが改善が必要な機能

### 11. 薬局側：応募一覧の表示内容
**設計書:** `pharmacy_system_design.md` 5.1 応募者一覧
**現状:**
- 応募者名が表示されている（手数料支払い前は非表示であるべき）
- 経験年数、専門分野の表示がない
**必要な修正:**
- 手数料支払い前は「応募者A」などの匿名表示
- 経験年数、専門分野の表示追加

### 12. 薬剤師側：応募時の資格証明書チェック
**設計書:** `pharmacist_system_design.md` 4.2.1 応募確認画面
**現状:**
- 応募時に資格証明書の確認状態をチェックしていない
**必要な修正:**
- 応募前に資格証明書の確認状態をチェック
- 未確認の場合は警告とプロフィールページへのリンク

### 13. 薬局側：求人投稿フォームのバリデーション
**設計書:** `pharmacy_system_design.md` 4.1.1 入力フォーム
**現状:**
- 一部のバリデーションが不足している可能性
**確認が必要:**
- 日給20,000円以上のチェック
- 勤務日数15〜90日のチェック
- 勤務開始可能期間（今日から2週間後以降）のチェック
- 募集期限（最短3日後、最長14日後）のチェック

---

## 📋 設計書との整合性チェックサマリー

### ✅ 実装済み（主要機能）

1. **認証機能** ✅
   - ログイン/ログアウト
   - メール認証（設計書に記載あり）

2. **薬剤師側プロフィール管理** ✅
   - 基本情報編集
   - 資格証明書アップロード
   - 証明書ステータス表示

3. **薬局側求人管理** ✅
   - 求人投稿
   - 求人一覧・編集・削除
   - 公開/非公開

4. **薬剤師側求人検索** ✅
   - フィルター機能（都道府県、日給、キーワード）
   - 求人一覧表示

5. **応募機能（基本）** ✅
   - 薬剤師側からの応募
   - 薬局側の応募一覧

6. **メッセージ機能** ✅
   - メッセージ送受信
   - 初回出勤日候補提案（薬局側）
   - 初回出勤日選択（薬剤師側）
   - 正式オファー確認・承認（薬剤師側）
   - メッセージクローズ後の表示・制限

7. **契約管理（基本）** ✅
   - 契約一覧（薬局側）
   - 契約詳細（薬局側）
   - 契約承認/辞退（薬剤師側）

8. **支払い管理（基本）** ✅
   - 請求書一覧（薬局側）
   - 請求書詳細（薬局側）
   - 支払い報告（薬局側）

### ❌ 未実装（主要機能）

1. **薬局側：正式オファー送信UI** ❌
2. **薬局側：応募者詳細ページ** ❌
3. **薬剤師側：求人詳細ページ** ❌
4. **薬剤師側：応募確認画面（必須情報入力）** ❌
5. **薬剤師側：勤務中の薬局（契約管理）ページ** ❌
6. **通知機能（全般）** ❌
7. **管理者機能（証明書確認、支払い確認）** ❌

---

## 🎯 user_journey_scenarios.md との整合性チェック

### ✅ 実装済みシーン

- Day 1: アカウント作成 ✅
- Day 1: プロフィール設定・証明書アップロード ✅
- Day 6: 求人検索 ✅
- Day 6: 応募（基本） ✅
- Day 6: メッセージ受信 ✅
- Day 6: 初回出勤日選択 ✅
- Day 7: 正式オファー受信・承認 ✅
- Day 8: 契約成立 ✅

### ❌ 未実装シーン

- Day 2: 管理者による証明書確認 ❌
- Day 6: 薬局側の応募者詳細確認 ❌
- Day 7: 薬局側の正式オファー送信 ❌
- Day 19: 管理者による支払い確認 ❌
- Day 19: 薬剤師側の契約詳細確認 ❌
- Day 19: 薬局の連絡先開示確認 ❌

---

## 📊 実装率

### 薬局側機能
- **実装済み:** 約70%
- **未実装:** 約30%

### 薬剤師側機能
- **実装済み:** 約75%
- **未実装:** 約25%

### 管理者側機能
- **実装済み:** 約0%
- **未実装:** 約100%

### 全体
- **実装済み:** 約65%
- **未実装:** 約35%

---

## 🔧 修正優先度

### 🔴 最優先（システム動作に必須）
1. バックエンドサーバー起動不可の修正
2. 薬局側：正式オファー送信UI
3. 薬剤師側：求人詳細ページ
4. 薬剤師側：応募確認画面

### 🟡 高優先度（主要フローに必要）
5. 薬局側：応募者詳細ページ
6. 薬剤師側：勤務中の薬局（契約管理）ページ
7. 薬局側：メッセージ画面の契約条件確認表示

### 🟢 中優先度（運用に必要）
8. 通知機能
9. 管理者機能（証明書確認、支払い確認）
10. 応募一覧の表示改善
11. 応募時の資格証明書チェック

---

## 📝 補足事項

### 設計書に記載がないが実装されている機能
- なし（確認済み）

### 実装されているが設計書に記載がない機能
- なし（確認済み）

### 設計書と実装で仕様が異なる点
- 応募フロー: 設計書では「求人詳細 → 応募確認画面 → 応募」だが、実装では「求人一覧 → 直接応募」
- 正式オファー送信: 設計書では「メッセージ画面から送信」だが、実装されていない

---

以上、設計書との整合性チェック結果
